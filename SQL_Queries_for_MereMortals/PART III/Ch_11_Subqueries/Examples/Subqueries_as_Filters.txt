-- List customers and all the details from their last order 

SELECT Customers.CustFirstName, Customers.CustLastName, 
Orders.OrderDate, Order_Details.ProductNumber,
Products.ProductName,
Order_Details.QuantityOrdered
FROM ((Customers
INNER JOIN Orders 
	ON Customers.CustomerID = Orders.CustomerID)
 INNER JOIN Order_Details
 	ON Orders.OrderNumber = Order_Details.OrderNumber)
 INNER JOIN Products
 	ON Products.ProductNumber = Order_Details.ProductNumber
WHERE Orders.OrderDate = 
	(SELECT MAX (OrderDate)
	FROM Orders AS O2 
	WHERE O2.CustomerId = Customers.CustomerID)
;


-- another solution 

SELECT RecipeTitle
FROM Recipes
WHERE Recipes.RecipeID IN 
	(SELECT RecipeID 
	FROM (Recipe_Ingredients
	INNER JOIN Ingredients 
		ON Recipe_Ingredients.IngredientID = 
			Ingredients.IngredientID)
	INNER JOIN Ingredient_Classes
		ON Ingredients.IngredientClassID =
		   Ingredient_Classes.IngredientClassID
		  WHERE
		  Ingredient_Classes.IngredientClassDescription = 'Seafood')



-- This version however could produce duplicate rows, and using a DISTINCT saved as a view might
    -- not be update able as the single output column might have duplicate values in many rows. Also, 
--  a view using DISTINCT will not update as it masks the unique identity of each underlying row. 
--	(The Recipes_Ingredients table might have many rows for each row in the Recipes table)

SELECT RecipeTitle
FROM ((Recipes
INNER JOIN Recipe_Ingredients
	ON Recipes.RecipeID = Recipe_Ingredients.RecipeID)
INNER JOIN Ingredients
	ON Recipe_Ingredients.IngredientID = 
		Ingredients.IngredientID)
INNER JOIN Ingredient_Classes 
	ON Ingredients.IngredientClassID = 
	Ingredient_Classes.IngredientClassID
WHERE 
Ingredient_Classes.IngredientClassDescription = 'Seafood'
;


-- List recipes and all ingredients for each recipe for recipes that have a seafood ingredient.

-- this query example retrieves all the ingredients for the recipes selected, and the complex 
-- subquery returns a list of recipe IDs for just the seafood recipes. 

SELECT Recipes.RecipeTitle, Ingredients.IngredientName
FROM (Recipes 
INNER JOIN Recipe_Ingredients
ON Recipes.RecipeID = Recipe_Ingredients.RecipeID)
INNER JOIN Ingredients
ON Ingredients.IngredientID = Recipe_Ingredients.IngredientID 
WHERE Recipes.RecipeID IN
	(SELECT RecipeID 
	FROM (Recipe_Ingredients
	INNER JOIN Ingredients 
		ON Recipe_Ingredients.IngredientID =
			Ingredients.IngredientID)
	INNER JOIN Ingredient_Classes
		ON Ingredients.IngredientClassID = 
		Ingredient_Classes.IngredientClassID
		WHERE 
		Ingredient_Classes.IngredientClassDescription = 'Seafood')
;

